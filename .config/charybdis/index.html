<style>
  #canvas {
    display: inline-grid;

    grid-template-columns: repeat(17, 1fr);
    grid-template-rows: repeat(6, 1fr);
    gap: 8px;
  }

  .cell:not(.empty) {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.125rem 0.375rem;
    border-radius: 0.1875rem;
    font-family: monospace;
    font-weight: 400;
    background-color: #eee;
    background-image: linear-gradient(to bottom, #ddd, #eee, #fff);
    box-shadow:
      0 -0.0625rem 0 0 #fff,
      0 0.0625rem 0 0.1875rem #aaa;
  }
</style>

<div id="canvas"></div>

<script>
  const keymaps = ["default", "custom", "miryoku-like"];
  const selectedKeymap =
    new URL(document.location).searchParams.get("keymap") ?? "default";
  const canvasElement = window.canvas;

  async function main() {
    const keymap = await fetch(`./keymaps/${selectedKeymap}.keymap.json`).then(
      (r) => r.json(),
    );

    const layout = await fetch(`./info.json`)
      .then((r) => r.json())
      .then((r) => r.layouts.LAYOUT.layout);

    const layoutLookup = layout.reduce((map, cell) => {
      map.set(cell.x + "," + cell.y, cell.matrix);
      return map;
    }, new Map());

    for (const layer of keymap.layers)
      for (let y = 0; y <= 5; y++)
        for (let x = 0; x <= 16; x++) {
          const cellElement = document.createElement("div");
          cellElement.classList.add("cell");

          const matrix = layoutLookup.get(x + "," + y);

          if (matrix) {
            const layerIndex = matrix[0] * 6 + matrix[1];
            cellElement.innerText = layer[layerIndex]
              .replaceAll(/KC_NO/g, "")
              .replaceAll(/KC_/g, "");
          } else {
            cellElement.classList.add("empty");
          }

          canvasElement.appendChild(cellElement);
        }
  }

  main();
</script>
